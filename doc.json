{"_id":"_design/student_validatie","_rev":"1-273cb37f7624c930b0a2fd7d4ed48a58","language":"javascript","validate_doc_update":"function (newDoc, oldDoc, userCtx, secObj) {\n  function requireField(field) {\n    if (!newDoc[field] || newDoc[field].trim() === '') {\n      throw({forbidden: 'Veld ' + field + ' mag niet leeg zijn.'});\n    }\n  }\n\n  if (newDoc.type !== 'student') {\n    throw({forbidden: 'Ongeldig type document: verwacht student.'});\n  }\n\n  var requiredFields = ['name','voornaam','achternaam','email','opleiding','mobiel','woonplaats','postcode','hostname','startDatum','eindDatum','status'];\n  requiredFields.forEach(requireField);\n\n  // created_at vereist bij nieuw document\n  if (!oldDoc) {\n    if (!newDoc.created_at || !/^\\\\d{4}-\\\\d{2}-\\\\d{2}$/.test(newDoc.created_at)) {\n      throw({forbidden: 'created_at ontbreekt of is ongeldig (verwacht formaat YYYY-MM-DD).'});\n    }\n  }\n\n  // updated_at verplicht bij iedere wijziging\n  if (!newDoc.updated_at || !/^\\\\d{4}-\\\\d{2}-\\\\d{2}$/.test(newDoc.updated_at)) {\n    throw({forbidden: 'updated_at ontbreekt of is ongeldig (verwacht formaat YYYY-MM-DD).'});\n  }\n\n  if (!Array.isArray(newDoc.stageDagen)) {\n    throw({forbidden: 'stageDagen moet een array zijn.'});\n  }\n  if (!Array.isArray(newDoc.opmerkingen)) {\n    throw({forbidden: 'opmerkingen moet een array zijn.'});\n  }\n}"}
